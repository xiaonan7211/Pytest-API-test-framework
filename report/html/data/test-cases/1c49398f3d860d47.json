{"uid":"1c49398f3d860d47","name":"test_generate_plan[正常生成计划]","fullName":"test_case.Plan.test_generate_plan.TestGeneratePlan#test_generate_plan","historyId":"e9dd9f1e70ab593d83d15975ff29d6bc","time":{"start":1669002865668,"stop":1669002865671,"duration":3},"description":"\n        :param :\n        :return:\n        ","descriptionHtml":"<pre><code>    :param :\n    :return:\n</code></pre>\n","status":"broken","statusMessage":"utils.other_tools.exceptions.DataAcquisitionFailed: sql 数据查询失败，请检查setup_sql语句是否正确【SELECT fca.action_id, fca.fitness_catalog_id, a.name FROM t_fitness_catalog_action as fca, t_action as a WHERE fca.action_id=a.id and a.status=\"1\" ORDER BY RAND() LIMIT 1】","statusTrace":"self = <utils.mysql_tool.mysql_control.SetUpMySQL object at 0x00000238558A1B50>\nsql = ['SELECT fca.action_id, fca.fitness_catalog_id, a.name FROM t_fitness_catalog_action as fca, t_action as a WHERE fca.action_id=a.id and a.status=\"1\" ORDER BY RAND() LIMIT 1']\n\n    def setup_sql_data(self, sql: Union[List, None]) -> Dict:\n        \"\"\"\n            处理前置请求sql\n            :param sql:\n            :return:\n            \"\"\"\n        sql = ast.literal_eval(cache_regular(str(sql)))\n        try:\n            data = {}\n            if sql is not None:\n                for i in sql:\n                    # 判断断言类型为查询类型的时候，\n                    if i[0:6].upper() == 'SELECT':\n>                       sql_date = self.query(sql=i)[0]\nE                       IndexError: tuple index out of range\n\nutils\\mysql_tool\\mysql_control.py:131: IndexError\n\nThe above exception was the direct cause of the following exception:\n\nself = <test_generate_plan.TestGeneratePlan object at 0x0000023855CAC610>\nin_data = {'assert_data': {'errorCode': {'AssertType': None, 'jsonpath': '$.code', 'type': '==', 'value': 0}, 'message': {'Asser...: {'ignore_list': {'age': 18, 'catalogId': '/01/02', 'gender': 1, 'height': 65000, ...}}, 'dependence_case': True, ...}\ncase_skip = None\n\n    @allure.story(\"生成计划接口\")\n    @pytest.mark.Plan\n    @pytest.mark.parametrize('in_data', eval(str_redata), ids=[i['detail'] for i in re_data])\n    def test_generate_plan(self, in_data, case_skip):\n        \"\"\"\n        :param :\n        :return:\n        \"\"\"\n>       res = RequestControl(in_data).http_request()\n\ntest_case\\Plan\\test_generate_plan.py:32: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nutils\\logging_tool\\log_decorator.py:24: in swapper\n    res = func(*args, **kwargs)\nutils\\logging_tool\\run_time_decorator.py:21: in swapper\n    res = func(*args, **kwargs)\nutils\\requests_tool\\request_control.py:441: in http_request\n    DependentCase(self.__yaml_case).get_dependent_data()\nutils\\requests_tool\\dependent_case.py:246: in get_dependent_data\n    _dependent_data = DependentCase(self.__yaml_case).is_dependent()\nutils\\requests_tool\\dependent_case.py:179: in is_dependent\n    self._dependent_type_for_sql(\nutils\\requests_tool\\dependent_case.py:114: in _dependent_type_for_sql\n    sql_data = SetUpMySQL().setup_sql_data(sql=setup_sql)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <utils.mysql_tool.mysql_control.SetUpMySQL object at 0x00000238558A1B50>\nsql = ['SELECT fca.action_id, fca.fitness_catalog_id, a.name FROM t_fitness_catalog_action as fca, t_action as a WHERE fca.action_id=a.id and a.status=\"1\" ORDER BY RAND() LIMIT 1']\n\n    def setup_sql_data(self, sql: Union[List, None]) -> Dict:\n        \"\"\"\n            处理前置请求sql\n            :param sql:\n            :return:\n            \"\"\"\n        sql = ast.literal_eval(cache_regular(str(sql)))\n        try:\n            data = {}\n            if sql is not None:\n                for i in sql:\n                    # 判断断言类型为查询类型的时候，\n                    if i[0:6].upper() == 'SELECT':\n                        sql_date = self.query(sql=i)[0]\n                        for key, value in sql_date.items():\n                            data[key] = value\n                    else:\n                        self.execute(sql=i)\n            return data\n        except IndexError as exc:\n>           raise DataAcquisitionFailed(f\"sql 数据查询失败，请检查setup_sql语句是否正确【{i}】\") from exc\nE           utils.other_tools.exceptions.DataAcquisitionFailed: sql 数据查询失败，请检查setup_sql语句是否正确【SELECT fca.action_id, fca.fitness_catalog_id, a.name FROM t_fitness_catalog_action as fca, t_action as a WHERE fca.action_id=a.id and a.status=\"1\" ORDER BY RAND() LIMIT 1】\n\nutils\\mysql_tool\\mysql_control.py:138: DataAcquisitionFailed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1669002832865,"stop":1669002832944,"duration":79},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0},{"name":"work_login_init","time":{"start":1669002832944,"stop":1669002833147,"duration":203},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0},{"name":"case_skip","time":{"start":1669002865668,"stop":1669002865668,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0}],"afterStages":[],"labels":[{"name":"story","value":"生成计划接口"},{"name":"feature","value":"计划服务"},{"name":"epic","value":"Gymery"},{"name":"tag","value":"Plan"},{"name":"parentSuite","value":"test_case.Plan"},{"name":"suite","value":"test_generate_plan"},{"name":"subSuite","value":"TestGeneratePlan"},{"name":"host","value":"GnYuHao"},{"name":"thread","value":"89080-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"test_case.Plan.test_generate_plan"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"in_data","value":"{'url': 'http://192.168.5.140:9000/s/v1/fitness/plan/generate', 'method': 'POST', 'detail': '正常生成计划', 'assert_data': {'errorCode': {'jsonpath': '$.code', 'type': '==', 'value': 0, 'AssertType': None}, 'message': {'jsonpath': '$.message', 'type': '==', 'value': '成功', 'AssertType': None}}, 'headers': {'Content-Type': 'application/json', 'Content-Length': None, 'Authorization': '$cache{login_cookie}'}, 'requestType': 'DATA', 'is_run': None, 'data': {'ignore_list': {'height': 65000, 'weight': 180, 'age': 18, 'gender': 1, 'catalogId': '/01/02', 'weeklyTrainingDays': [0, 1, 2, 3, 4, 5, 6]}}, 'dependence_case': True, 'dependence_case_data': [{'case_id': 'self', 'dependent_data': [{'dependent_type': 'sqlData', 'jsonpath': '$.fitness_catalog_id', 'set_cache': None, 'replace_key': '$.data.catalogId'}]}], 'sql': None, 'setup_sql': ['SELECT fca.action_id, fca.fitness_catalog_id, a.name FROM t_fitness_catalog_action as fca, t_action as a WHERE fca.action_id=a.id and a.status=\"1\" ORDER BY RAND() LIMIT 1'], 'status_code': None, 'teardown_sql': None, 'teardown': None, 'current_request_set_cache': [{'type': 'response', 'jsonpath': '$.value', 'name': 'insert_plan_ID'}], 'sleep': None}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["Plan"]},"source":"1c49398f3d860d47.json","parameterValues":["{'url': 'http://192.168.5.140:9000/s/v1/fitness/plan/generate', 'method': 'POST', 'detail': '正常生成计划', 'assert_data': {'errorCode': {'jsonpath': '$.code', 'type': '==', 'value': 0, 'AssertType': None}, 'message': {'jsonpath': '$.message', 'type': '==', 'value': '成功', 'AssertType': None}}, 'headers': {'Content-Type': 'application/json', 'Content-Length': None, 'Authorization': '$cache{login_cookie}'}, 'requestType': 'DATA', 'is_run': None, 'data': {'ignore_list': {'height': 65000, 'weight': 180, 'age': 18, 'gender': 1, 'catalogId': '/01/02', 'weeklyTrainingDays': [0, 1, 2, 3, 4, 5, 6]}}, 'dependence_case': True, 'dependence_case_data': [{'case_id': 'self', 'dependent_data': [{'dependent_type': 'sqlData', 'jsonpath': '$.fitness_catalog_id', 'set_cache': None, 'replace_key': '$.data.catalogId'}]}], 'sql': None, 'setup_sql': ['SELECT fca.action_id, fca.fitness_catalog_id, a.name FROM t_fitness_catalog_action as fca, t_action as a WHERE fca.action_id=a.id and a.status=\"1\" ORDER BY RAND() LIMIT 1'], 'status_code': None, 'teardown_sql': None, 'teardown': None, 'current_request_set_cache': [{'type': 'response', 'jsonpath': '$.value', 'name': 'insert_plan_ID'}], 'sleep': None}"]}